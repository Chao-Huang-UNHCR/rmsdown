---
title: "RMS South Sudan 2023"
author: "Global Data Service - Statistics and Demographics Section"
date: "2024-10-10"
output: rmsdown::paged_report
---


# Executive Summary

A short summary for readers to become acquainted with the key messages without having to read the entire report.
It should include the assessment objectives, methods used, key findings, conclusions, and recommendations.
Use bullet points and refer to relevant chapters so readers can find more detail if required.

## Key Findings

-   item 1
-   item 2
-   item 3

## Recommandations

-   Secure adequate financial resources to meet the needs.
-   Encourage the national authorities to assume a leading role in the humanitarian response.
-   Scale up the services provided.
-   Prioritize key activities to ensure proper protection of the most vulnerable individuals.
-   Focus on the lowest performance and categorize critical gaps.
-   item
-   item


# Introduction

**Overall and specific objectives and focus of the Results Monitoring Surveys, including the coverage (populations, sectors, and geographic areas) and the types of decisions need to be informed.**

Since the outbreak of the civil war in 2013, the crisis in South Sudan has worsened in various areas, including personal safety, protection, food security, livelihoods, health, shelter, and sanitation.
Many people have been forced to flee their homes in search of a safer and more stable locations, resulting in significant displacements.
Adding to the conflict, severe flooding has further strained the already poor infrastructure, disrupting the supply chain and causing damage to people's livelihoods and properties.
As a result, impoverished individuals have become increasingly vulnerable and marginalized, residing in isolated rural communities.
Access to essential services remains limited, and the humanitarian situation is a genuine cause for concern.

In the recent course of events, the 2023 Sudan crisis significantly worsened the already dire humanitarian conditions in South Sudan due to several interconnected factors: the conflict led to mass displacement within the country, with over 1 million people fleeing to neighbouring countries like South Sudan.
This influx placed an immense strain on South Sudan's limited resources and infrastructure, particularly in areas already grappling with internal displacement from previous conflicts.
Moreover, the crisis disrupted critical trade routes and humanitarian corridors between Sudan and South Sudan, leading to shortages of essential supplies like food, medicine, and fuel.
This resulted in price hikes, exacerbating existing food insecurity, and making aid delivery more difficult and expensive.
In addition, the international community's focus shifted towards addressing the crisis in Sudan, leading to a decrease in funding and attention towards South Sudan's ongoing humanitarian needs.
It limited the capacity of aid organizations to effectively respond to the growing challenges.
The latest developments and the shift of priorities in terms of the response plans and main activities may have a significant effect on the 2023 results in comparison to 2022 results.

South Sudan faces a daunting reality: with 11.1 million people as per the latest 2023 estimations by UNFPA, it struggles against widespread poverty and illiteracy.
Yet, hope persists.
Recognizing the dire situation, the international community, including UN agencies, has joined forces with the South Sudanese government.
Together, they strive to alleviate the suffering by providing aid and support across various sectors.
This collaboration aims to mitigate the effects of poverty, illiteracy, and other pressing issues, ultimately offering a helping hand to the millions affected.

UNHCR in South Sudan prioritizes the well-being of those most affected by conflict and displacement.
Driven by a commitment to protect and assist vulnerable people, their actions are guided by evidence-based decision-making.
Recognizing the crucial role of data, UNHCR globally implemented the Results-Monitoring Survey (RMS) in 2022 to create the baseline data of the impact and outcome indicators.
As this is an annual approach, the exercise was replicated in 2023.
This methodology tracks progress and impact against the baseline data, solidifying UNHCR position as a trusted leader on refugee and displacement data.

## Methods

### Data Collection 

Furthermore, provide some information about the data collection methods and an analysis plan annex that operationalizes the analytical framework and details questions, data collections methods and sources for each information element sought, as well as how the information have been analysed.

This field work report presents the process of implementing the 2023 Results Monitoring Survey (RMS) conducted by UNHCR South Sudan, with support from the Regional Bureau of the East, Horn and Great Lakes of Africa and guidance from UN Headquarters.
The RMS serves as a tool to measure the progress of country operations using impact and outcome indicators.

The survey was conducted using the computer-assisted personal interviews (CAPI) method at the County level across 9 states of South Sudan, including 41 Counties.
UNHCR, with the support of its partners, reached 6,266 households through a simple random sampling method and, in some cases, based on a set list provided by the local authorities (RRC).
The survey delves into key areas: mobility, disability, housing, basic needs, safety, income, and gender-based violence, providing insights into life for Internally Displaced Persons (IDPs).

## Questionnaire

## Sampling strategy

Type of sampling design and rationale for this design.
Sample size and locations.
Deviation from the original sampling strategy, including non-response rate and replacement method.
More detailed information such as the sample plan can be annexed.

**Map of the country (South Sudan in this case) that demonstrates data collection locations**

```{r, echo=FALSE}


##Add a map here using latitude and longitude
```




The target population groups, covered within RMS 2023, are the internally displaced persons (IDPs) and Refugees Returnees.
According to the latest IOM Displacement Mobility Tracking (DTM Round 14), over 2 million IDPs were mapped and over 530,000 returnees were recorded throughout 2023.

## Enumerator and training

Explain the profile of the enumerators/survey firm and how enumerators were trained.

Following RMS 2022, UNHCR incorporated the RMS 2023 within the partnership agreements with different partners operating across South Sudan to ensure their re-engagement and continuity to carry out this activity.
Since most of the field enumerators were familiar with the RMS methodology.
This allowed to further strengthen their capacity and manifest a strong command during the data collection phase.

The MFT (Multi-functional Team) members approached the focal person of each relevant partner to confirm their preparedness to launch this exercise.
Both sides discussed the needs in terms of workforce, budgeting, provision of trainings, provision of materials and reached to an agreement on the overall workplan and timeline.

In coordination with the UNHCR field offices, MFT members organized and successfully delivered 6 training sessions in 5 locations: Juba, Yei, Wau, Yambio and Bentiu in which an extensive practical use of the devices, a simulation of the data collection exercise and data protection policies were offered.
Subsequently, UNHCR managed to adequately train a total number of 93 enumerators.

## Workplan

Timeline of different phases of the assessment, including training, pilot phase, primary data collection (if any) and analysis.

The field work covered 9 states of South Sudan.
The data collection took place from 03 December 2023 to 07 February 2024 in 41 counties.

## Limitations

Any known limitations of the survey approach and findings, including sources of potential bias or error.

The complex context of South Sudan does not provide the right conditions for the implementation of humanitarian activities in a safe and uninterrupted manner.
In this year's exercise, many factors impeded the data collection at different levels:\

-   *Insecurity*: Due to insecurity in Western Bahr el Ghazal, namely, Wau-Kuajok road, the activity was suspended until the movement restrictions were lifted.

-   *Mobility*: Due to the flooding, the road to Adok port was impassable with limited means of transportation.
    The enumerators had to take motorbikes services at a significant higher cost.

-   *Internet reliability*: In some remote areas, internet connectivity was entirely absent or highly poor.
    Under this condition, the field enumerators were collecting data, in these locations, off-line.
    As the uploading took place at a later stage, The data quality check could not be done in real-time.

-   *Questionnaire length*: The bigger the family size is, the longer the interview lasts.
    Some respondents

-   *Assumptions*: Some respondents expected to be paid after the personal interview.

-   *Technical issues*: Some tablets were unable to connect to Internet and had to be switched off and on several times

# Findings

## Demographics



```{r, include=FALSE}
####Load libraries and data ----

# Install pacman if not already installed
if(!require(pacman)) install.packages('pacman')

# Load all required libraries using pacman
pacman::p_load(
  tidyverse, dplyr, tidyr, rlang, purrr, magrittr, expss, srvyr,
  readr,labelled,pastecs,psych,tableone, outbreaks, ggplot2, unhcrthemes,
  scales, gt,webshot2, sjlabelled, waffle, writexl, remotes, glue, readxl, gt,
  knitr,kableExtra)


##Load datasets -- both datasets includes indicators already calculated and cleaned ( step 1 and 2 are complete)

main<- read_excel("main.xlsx")
ind <- read_excel("ind.xlsx")



```


```{r setup, include=FALSE}

##Calculate some numbers to insert inside the text
total_households <- nrow(main)
total_individuals <- nrow(ind)

refugee_returnees_households <- main %>%
  filter(pop_groups == "Refugee returnees") %>%
  nrow() 

idp_households <- main %>%
  filter(pop_groups == "IDPs") %>%
  nrow()

ind_female <- ind %>%
  filter(HH04 == "Female") %>%
  nrow()


ind_male <- ind %>%
  filter(HH04 == "Male") %>%
  nrow()

ind_age_below18 <- ind %>%
  filter(HH07_cat2 =="0-17") %>%
  nrow()

ind_age_above18 <- ind %>%
  filter(HH07_cat2 =="18+") %>%
  nrow()
```

The total sample consisted of `r total_households` households.
Of these households, `r idp_households` were internally displaced persons (IDPs) and `r refugee_returnees_households` were refugee returnees.
A total of `r total_individuals` individuals were interviewed, with more than half `r ind_female` being female and `r ind_male` being male.
Among the interviewed individuals,were `r ind_age_above18`18 years or above.
Children comprised a large age group at `r ind_age_below18`.


```{r, include=FALSE}


### Creating the survey design object -- for individual and HH level datasets 


#### Creating the survey design object without stratification ---- for individual and HH level datasets 
RMS_SSD_2023_ind <- ind %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )


RMS_SSD_2023_main <- main %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )


```



## Realizing Rights in Safe Environments

### 2.2 Proportion of people residing in physically safe and secure settlements with access to basic facilities


To facilitate measurement specific to UNHCR, four basic services are considered for this indicator: shelter, drinking water, energy (access to electricity) and health in addition to the security.
All of these basic services must be available to people for it to be considered that they have access to basic services.


```{r, include=FALSE}

composite_impact2_2 <- main %>%
  select(pop_groups, shelter, electricity, drinkingwater, secure, healthcare, impact2_2) %>%
  pivot_longer(cols = shelter:healthcare, names_to = "facility", values_to = "access") %>%
  group_by(pop_groups, facility) %>%
  summarise(percentage = mean(access, na.rm = TRUE) * 100) %>%
  ungroup()


impact2_2 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "impact2_2",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(impact2_2, vartype = c("ci", "se"), , na.rm = TRUE),  # indicator value ( weighted) with CI and SE
  )



```



```{r impact2_2 Composite, echo=FALSE, warning=FALSE}

composite_impact2_2 %>%
  ggplot(aes(x = facility, y = percentage, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), # Add percentage labels
            position = position_dodge(width = 0.9),         # Adjust position for dodged bars
            vjust = -0.25,                                  # Move labels slightly above bars
            size = 3) +                                     # Adjust text size
  scale_fill_unhcr_d() +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  labs(
    title = "Access to Facilities by Population Group",
    x = "Facility",
    y = "Percentage Access (%)",
    fill = "Population Groups"
  ) +
  theme_unhcr()


```


```{r impact2_2 by population groups, echo=FALSE, warning=FALSE}

ggplot(impact2_2, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Impact 2.2",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )


```



### 2.3 Proportion of people with access to health services

```{r, include=FALSE}

###Table by population groups

impact2_3 <- RMS_SSD_2023_ind %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "impact2_3",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(impact2_3, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


#### Table and chart that shows results by age/sex/diversity


impact2_3_AGD <- RMS_SSD_2023_ind %>%
  filter(!is.na(HH04) & !is.na(disability) & !is.na(HH07_cat)) %>%                     # Exclude if HH07_cat is NA
  group_by(HH07_cat, HH04, disability) %>%            # Group by Age, Gender, and Disability
  summarise(                                       # Summarise to compute values
    var_name = "impact2_3",                        # Name of the variable
    num_mean_uw = unweighted(n()),                  # Unweighted total count
    denominator = survey_total(),                  # Weighted total count
    mean_value = survey_mean(impact2_3, vartype = c("ci", "se", "cv"), na.rm = TRUE)  # Compute mean with NA removed
  )




#### The reasons for not being able to access to health services 

##add labels for not accessing the health services

reasons_mapping <- c(
  "HACC04_1" = "Health facility too far",
  "HACC04_2" = "Medicine or health facility too expensive",
  "HACC04_3" = "No treatment exists/Not necessary",
  "HACC04_4" = "Don't know where to go",
  "HACC04_5" = "No time",
  "HACC04_6" = "Prefer other options",
  "HACC04_7" = "Health facility does not accept new patients",
  "HACC04_8" = "Don't trust modern medicine",
  "HACC04_9" = "Don't trust doctors",
  "HACC04_10" = "Administrative/documentation issues (certificates, service cards, etc.)",
  "HACC04_11" = "Long waiting times",
  "HACC04_12" = "Lack of medical supplies",
  "HACC04_13" = "Health facility damaged/destroyed"
)

hacc_percentages <- ind %>%
  summarise(
    HACC04_1 = mean(HACC04_1 == 1, na.rm = TRUE) * 100,
    HACC04_2 = mean(HACC04_2 == 1, na.rm = TRUE) * 100,
    HACC04_3 = mean(HACC04_3 == 1, na.rm = TRUE) * 100,
    HACC04_4 = mean(HACC04_4 == 1, na.rm = TRUE) * 100,
    HACC04_5 = mean(HACC04_5 == 1, na.rm = TRUE) * 100,
    HACC04_6 = mean(HACC04_6 == 1, na.rm = TRUE) * 100,
    HACC04_7 = mean(HACC04_7 == 1, na.rm = TRUE) * 100,
    HACC04_8 = mean(HACC04_8 == 1, na.rm = TRUE) * 100,
    HACC04_9 = mean(HACC04_9 == 1, na.rm = TRUE) * 100,
    HACC04_10 = mean(HACC04_10 == 1, na.rm = TRUE) * 100,
    HACC04_11 = mean(HACC04_11 == 1, na.rm = TRUE) * 100,
    HACC04_12 = mean(HACC04_12 == 1, na.rm = TRUE) * 100,
    HACC04_13 = mean(HACC04_13 == 1, na.rm = TRUE) * 100
  ) %>%
  pivot_longer(cols = everything(), 
               names_to = "Reason", 
               values_to = "Percentage") %>%
  mutate(Reason = reasons_mapping[Reason])  # Map column names to descriptive labels





```

```{r Impact2_3 by population groups, echo=FALSE, warning=FALSE}


ggplot(impact2_3, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Impact 2.3",
    x = "Population Groups",
    y = "Mean value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )




```



```{r Impact2_3 by AGD, echo=FALSE, warning=FALSE}


ggplot(impact2_3_AGD, aes(x = HH04, y = mean_value, fill = disability)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  scale_fill_unhcr_d() +  # UNHCR color palette
  facet_wrap(~ HH07_cat) +  # Create facets for each age group
  labs(
    title = "Impact 2.3 by gender, age and disability status",
    x = "Gender",
    y = "Mean Value",
    fill = "Disability",
    caption = "Note: The disability module does not include children under 5."  #
  ) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )

```



```{r Reasons for not accessing health, echo=FALSE, warning=FALSE}



ggplot(hacc_percentages, aes(x = reorder(Reason, Percentage), y = Percentage, fill = Reason)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), 
            position = position_stack(vjust = 0.5), size = 3.5) +  # Add percentage labels on bars
  coord_flip() +  # Flip the axes for better readability
  labs(
    title = "Reasons for Not Accessing Health Services",
    x = "Reason",
    y = "Percentage",
    caption = "Note: Percentages calculated independently for each reason."
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.y = element_text(size = 9),  # Adjust text size for readability
    legend.position = "none"  # Remove the legend for simplicity
  )



```


## Empowering Communities and Achieving Gender Equality

### 3.2a Proportion of children and young people enrolled in primary education 



```{r, include=FALSE}


impact3_2a <- RMS_SSD_2023_ind %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop_groups is NA
  group_by(pop_groups) %>%                          # Group by pop_groups
  summarise(
    var_name = "impact3_2a",                        # Name of the variable
    num_obs_uw = survey_total(!is.na(age_primary), na.rm = TRUE),  # Unweighted total count
    denominator = survey_total(edu_primary, na.rm = TRUE),         # Weighted total count
    edu_primary_total = survey_total(edu_primary, na.rm = TRUE),   # Total for edu_primary
    age_primary_total = survey_total(age_primary, na.rm = TRUE)    # Total for age_primary
  ) %>%
  mutate(
    mean_value = round(edu_primary_total / age_primary_total, 4)  # Calculate the mean value
  )


###Table with gender and disability included for the chart



impact3_2a_AGD <- RMS_SSD_2023_ind %>%
  filter(!is.na(pop_groups) & !is.na(disability) & !is.na(HH04)) %>%                     # Exclude if pop_groups is NA
  group_by(pop_groups,disability,HH04) %>%                          # Group by pop_groups
  summarise(
    var_name = "impact3_2a",                        # Name of the variable
    num_obs_uw = survey_total(!is.na(age_primary), na.rm = TRUE),  # Unweighted total count
    denominator = survey_total(edu_primary, na.rm = TRUE),         # Weighted total count
    edu_primary_total = survey_total(edu_primary, na.rm = TRUE),   # Total for edu_primary
    age_primary_total = survey_total(age_primary, na.rm = TRUE)    # Total for age_primary
  ) %>%
  mutate(
    mean_value = round(edu_primary_total / age_primary_total, 4)  # Calculate the mean value
  )



```




```{r, echo=FALSE, warning=FALSE}



###Chart for the above table


ggplot(impact3_2a_AGD, aes(x = HH04, y = mean_value, fill = disability)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3) +  # Add values on bars
  facet_wrap(~ pop_groups) +  # Create separate plots for each pop_group
  labs(
    title = "Enrollment in primary education by Age, Gender, and Population Groups",
    x = "Gender ",
    y = "Proportion of Education Level",
    fill = "Disability Status"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )


```

### 3.2b Proportion of children and young people enrolled in secondary education 



```{r, include=FALSE}
##Results of the indicator table


impact3_2b <- RMS_SSD_2023_ind %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop_groups is NA
  group_by(pop_groups) %>%                          # Group by pop_groups
  summarise(
    var_name = "impact3_2b",                        # Name of the variable 
    num_obs_uw = survey_total(!is.na(age_secondary), na.rm = TRUE),  # Unweighted total count for secondary age
    denominator = survey_total(edu_secondary, na.rm = TRUE),         # Weighted total count for secondary education
    edu_secondary_total = survey_total(edu_secondary, na.rm = TRUE), # Total for secondary education
    age_secondary_total = survey_total(age_secondary, na.rm = TRUE)  # Total for secondary age
  ) %>%
  mutate(
    mean_value = round(edu_secondary_total / age_secondary_total, 4)  # Calculate the mean value
  )


###Table with gender and disability included for the chart


impact3_2b_AGD <- RMS_SSD_2023_ind %>%
  filter(!is.na(pop_groups) & !is.na(disability) & !is.na(HH04)) %>%  # Exclude if pop_groups, disability, or HH04 is NA
  group_by(pop_groups, disability, HH04) %>%                          # Group by pop_groups, disability, and HH04
  summarise(
    var_name = "impact3_2b",                                          # Name of the variable (changed to impact3_2b)
    num_obs_uw = survey_total(!is.na(age_secondary), na.rm = TRUE),   # Unweighted total count for secondary age
    denominator = survey_total(edu_secondary, na.rm = TRUE),          # Weighted total count for secondary education
    edu_secondary_total = survey_total(edu_secondary, na.rm = TRUE),  # Total for secondary education
    age_secondary_total = survey_total(age_secondary, na.rm = TRUE)   # Total for secondary age
  ) %>%
  mutate(
    mean_value = round(edu_secondary_total / age_secondary_total, 4)  # Calculate the mean value
  )





```


```{r, echo=FALSE, warning=FALSE}

###Chart for the above table

ggplot(impact3_2b_AGD, aes(x = HH04, y = mean_value, fill = disability)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3) +  # Add values on bars
  facet_wrap(~ pop_groups) +  # Create separate plots for each pop_group
  labs(
    title = "Enrollment in Secondary Education by Age, Gender, and Population Groups",
    x = "Gender",
    y = "Proportion of Education Level",
    fill = "Disability Status"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )

```

### 3.3 Proportion of people feeling safe walking alone in their neighbourhood after dark




```{r, include=FALSE}


###Table standard 


impact3_3 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "impact3_3",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(impact3_3, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )




#### Table and chart that shows results by age/sex/diversity

impact3_3_AGD <- RMS_SSD_2023_main %>%
  filter(!is.na(HH04) & !is.na(disability) & !is.na(HH07_cat) & HH07 > 18) %>%  # Exclude HH07_cat categories 1, 2, and 5
  group_by(HH07_cat, HH04, disability) %>%
  summarise(
    var_name = "impact3_3",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(impact3_3), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(impact3_3, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )


####Chart with the AGD variables 


navy_palette <- c("#E0E9FE", "#B8C9EE", "#8395B9", "#506489", "#18375F")
red_palette <- c(unhcr_pal(12, "pal_red"))

##Table with education level for randomly selected adult


impact3_3_EDU <- RMS_SSD_2023_main %>%
  filter(!is.na(EDU01_random) & HH07 > 18) %>%  # Exclude EDU01_random
  group_by(EDU01_random) %>%
  summarise(
    var_name = "impact3_3",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(impact3_3), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(impact3_3, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )



```


```{r, echo=FALSE, warning=FALSE}

##Chart for the indicator above



ggplot(impact3_3, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Impact 3.3",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )


```

```{r, echo=FALSE, warning=FALSE}

##Chart for the indicator above


ggplot(impact3_3_AGD, aes(x = disability, y = mean_value, fill = HH04)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +  # Grouped bar chart
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3.5) +  # Add values on bars
  scale_fill_manual(values = c(navy_palette[4], red_palette[2])) +  # Apply custom color palette
  facet_wrap(~ HH07_cat) +  # Create facets for each age group
  labs(
    title = "Impact 3.3 by Gender, Age, and Disability Status",
    x = "Disability Status",
    y = "Mean Value",
    fill = "Gender",
    caption = "Note: Only 18 and above"
  ) +
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +  # Limit the y-axis from 0 to 1
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for readability
    axis.text.y = element_text(size = 10)  # Adjust y-axis label size for readability
  )




```


## Access to Territory, Registration and Documentation

### 1.2 Proportion of children under 5 years of age whose births have been registered with a civil authority



```{r, include=FALSE}


outcome1_2 <- RMS_SSD_2023_ind %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "outcome1_2",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(outcome1_2, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


##Table with disability and gender


outcome1_2_AGD <- RMS_SSD_2023_ind %>%
  filter(!is.na(HH04) & !is.na(disability) & !is.na(pop_groups) & HH07 < 5 ) %>%  # Exclude HH07_cat categories 1, 2, and 5
  group_by(HH07_cat, HH04, pop_groups) %>%
  summarise(
    var_name = "outcome1_2",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(impact3_3), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(outcome1_2, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )


##Chart with pop groups

gender_colors <- c("Male" = "#8395B9", "Female" = "#E0E9FE")




```


```{r, echo=FALSE, warning=FALSE}


ggplot(outcome1_2_AGD, aes(x = HH04, y = mean_value, fill = HH04)) +  # Fill mapped to HH04 for gender
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3) +  # Add values on bars
  facet_wrap(~ pop_groups) +  # Create separate plots for each population group
  labs(
    title = "Outcome 1.2 by Population Groups and Gender",
    x = "Gender",
    y = "Proportion of Children that registered",
    caption = "Note: Only children under 5"
  ) +
  scale_fill_manual(values = gender_colors) +  # Apply custom colors for male and female
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )


```

### 1.3 Proportion of people with legally recognized identity documents or credentials


This indicator also corresponds to the Core Outcome Indicator 14.1 Proportion of returnees with legally recognized identity documents or credentials only for refugee returnees.

```{r, include=FALSE}

###Table by population groups

outcome1_3 <- RMS_SSD_2023_ind %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "outcome1_3",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(outcome1_3, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


outcome14_1 <- RMS_SSD_2023_ind %>%
  filter(pop_groups == 'Refugee returnees') %>%  # Use equivalent of pop groups for refugee returnees
  group_by(pop_groups) %>%  # Group by pop_groups
  summarise(  
    var_name = "outcome14_1",  # Name of the variable
    num_obs_uw = unweighted(n()),  # Unweighted total count
    denominator = survey_total(),  # Weighted total count
    mean_value = survey_mean(outcome14_1, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


#### Table and chart that shows results by age/sex/diversity

outcome1_3_AGD <- RMS_SSD_2023_ind %>%
  filter(!is.na(HH04) & !is.na(disability) & !is.na(HH07_cat)) %>%                     # Exclude if HH07_cat is NA
  group_by(HH07_cat, HH04, disability) %>%            # Group by Age, Gender, and Disability
  summarise(                                       # Summarise to compute values
    var_name = "outcome1_3",                        # Name of the variable
    num_obs_uw = unweighted(n()),                  # Unweighted total count
    denominator = survey_total(),                  # Weighted total count
    mean_value = survey_mean(outcome1_3, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )

###define labels 

identity_documents <- c(
  "REG01a" = "Passport",
  "REG01b" = "Birth certificate",
  "REG01c" = "Civil/ government issued ID",
  "REG01d" = "Residency permit",
  "REG01e" = "Statelessness documentation",
  "REG01f" = "Household card of address/family book",
  "REG01g" = "Social security card",
  "REG02" = "Any other document"
)

# Calculate the percentage of '1's for each identity document


identity_document_percentages <- RMS_SSD_2023_ind %>%
  summarise(across(c(REG01a, REG01b, REG01c, REG01d, REG01e, REG01f, REG01g, REG02),
                   ~ mean(. == 1, na.rm = TRUE) * 100)) %>%
  pivot_longer(cols = everything(), 
               names_to = "Document", 
               values_to = "Percentage") %>%
  mutate(Document = identity_documents[Document])  # Map column names to descriptive labels


```


```{r, echo=FALSE, warning=FALSE}
##Chart for the indicator above


ggplot(outcome1_3, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 1.3",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )

```


```{r, echo=FALSE, warning=FALSE}
####Chart with the AGD variables 

ggplot(outcome1_3_AGD, aes(x = HH04, y = mean_value, fill = disability)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +  # Grouped bar chart
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3) +  # Add values on top of bars
  scale_fill_unhcr_d() +  # Apply UNHCR color palette
  facet_wrap(~ HH07_cat) +  # Create facets for each age group
  labs(
    title = "Outcome 1.3 by Gender, Age, and Disability Status",
    x = "Gender",
    y = "Mean Value",
    fill = "Disability",
    caption = "Note: The disability module does not include children under 5."
  ) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for readability
    axis.text.y = element_text(size = 10)  # Adjust y-axis label size for readability
  )


```


```{r, echo=FALSE, warning=FALSE}
# Create the bar chart
ggplot(identity_document_percentages, aes(x = reorder(Document, Percentage), y = Percentage, fill = Document)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), 
            position = position_stack(vjust = 0.5), size = 3.5) +  # Add percentage labels on bars
  coord_flip() +  # Flip the axes for better readability
  labs(
    title = "Percentage of Individuals Holding Identity Documents",
    x = "Identity Document",
    y = "Percentage",
    caption = "Note: Percentages are calculated independently for each document for individuals 5 and above."
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.y = element_text(size = 9),  # Adjust text size for readability
    legend.position = "none"  # Remove the legend for simplicity
  )
```


## Gender-based Violence

### 4.1 Proportion of people who know where to access available GBV services

```{r, include=FALSE}

#####Table standard 

outcome4_1 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "outcome4_1",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(!is.na(outcome4_1), vartype = NULL),                    # Weighted total count
    mean_value = survey_mean(outcome4_1, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )

#### Table and chart that shows results by age/sex/diversity

outcome4_1_AGD <- RMS_SSD_2023_main %>%
  filter(!is.na(HH04) & !is.na(disability) & !is.na(HH07_cat) & HH07 > 18) %>%  # only 18 and above 
  group_by(HH07_cat, HH04, disability) %>%
  summarise(
    var_name = "outcome4_1",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(outcome4_1), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(outcome4_1, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )


####Chart with the AGD variables 


navy_palette <- c("#E0E9FE", "#B8C9EE", "#8395B9", "#506489", "#18375F")
red_palette <- c(unhcr_pal(12, "pal_red"))

###define labels 

gbv_services <- c(
  "GBV01a" = "Health services",
  "GBV01b" = "Psycho-social services",
  "GBV01c" = "safety and security services",
  "GBV01d" = "Legal assistance"
)

# Calculate the percentage of '1's for each identity document


gbv01_percentages <- RMS_SSD_2023_main %>%
  summarise(across(c(GBV01a, GBV01b, GBV01c, GBV01d),
                   ~ mean(. == 1, na.rm = TRUE) * 100)) %>%
  pivot_longer(cols = everything(), 
               names_to = "Services", 
               values_to = "Percentage") %>%
  mutate(Services = gbv_services[Services])  # Map column names to descriptive labels



##Table with education level for randomly selected adult

outcome4_1_EDU <- RMS_SSD_2023_main %>%
  filter(!is.na(EDU01_random) ) %>%  # Exclude EDU01_random
  group_by(EDU01_random) %>%
  summarise(
    var_name = "outcome4_1",                                      # Name of the variable
    num_obs_uw = survey_total(),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(outcome4_1, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )


```


```{r, echo=FALSE, warning=FALSE}
##Chart for the indicator above



ggplot(outcome4_1, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 4.1",
    x = "Population Groups",
    y = "Mean value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```

```{r, echo=FALSE, warning=FALSE}

ggplot(outcome4_1_AGD, aes(x = disability, y = mean_value, fill = HH04)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +  # Grouped bar chart
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3.5) +  # Add values on bars
  scale_fill_manual(values = c(navy_palette[4], red_palette[2])) +  # Apply custom color palette
  facet_wrap(~ HH07_cat) +  # Create facets for each age group
  labs(
    title = "Outcome 4.1 by Gender, Age, and Disability Status",
    x = "Disability Status",
    y = "Mean Value",
    fill = "Gender",
    caption = "Note: Only 18 and above"
  ) +
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +  # Limit the y-axis from 0 to 1
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for readability
    axis.text.y = element_text(size = 10)  # Adjust y-axis label size for readability
  )


```

```{r, echo=FALSE, warning=FALSE}
# Create the bar chart

ggplot(gbv01_percentages, aes(x = reorder(Services, Percentage), y = Percentage, fill = Services)) +
  geom_bar(stat = "identity", width = 0.7) +  # Use "identity" for stat
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), 
            position = position_stack(vjust = 0.5), size = 3.5) +  # Add percentage labels inside bars
  coord_flip() +  # Flip the axes for better readability
  labs(
    title = "Knowledge on where to access available GBV services",
    x = "GBV Services",
    y = "Percentage",
    caption = "Note: Percentages are calculated independently for each service for individuals 5 and above."
  ) +
  scale_fill_unhcr_d() +  # Apply UNHCR color palette
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.y = element_text(size = 9),  # Adjust y-axis text size for readability
    legend.position = "none"  # Remove legend for simplicity
  )

```

### 4.2 Proportion of people who do not accept violence against women



```{r, include=FALSE}


outcome4_2 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "outcome4_2",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(outcome4_2, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


#### Table and chart that shows results by age/sex/diversity

outcome4_2_AGD <- RMS_SSD_2023_main %>%
  filter(!is.na(HH04) & !is.na(disability) & !is.na(HH07_cat) & HH07 > 18) %>%  # only 18 and above 
  group_by(HH07_cat, HH04, disability) %>%
  summarise(
    var_name = "outcome4_2",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(outcome4_2), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(outcome4_2, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )

####Chart with the AGD variables 


navy_palette <- c("#E0E9FE", "#B8C9EE", "#8395B9", "#506489", "#18375F")
red_palette <- c(unhcr_pal(12, "pal_red"))

## Gender-based Violence


vaw_options <- c(
  VAW01a = "If she goes out without telling him",
  VAW01b = "If she neglects the children",
  VAW01c = "If she argues with him",
  VAW01d = "If she refuses to have sex with him",
  VAW01e = "If she burns the food"
)

# Summarize the percentages for each question
vaw01_percentages <- main %>%
  summarise(across(c(VAW01a, VAW01b, VAW01c, VAW01d, VAW01e),
                   ~ mean(. == 1, na.rm = TRUE) * 100)) %>%
  pivot_longer(cols = everything(), 
               names_to = "Question", 
               values_to = "Percentage") %>%
  mutate(Question = vaw_options[Question])  # Map column names to descriptive labels


```


```{r, echo=FALSE, warning=FALSE}
##Chart for the indicator above



ggplot(outcome4_2, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 4.2",
    x = "Population Groups",
    y = "Mean value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```


```{r, echo=FALSE, warning=FALSE}

ggplot(outcome4_2_AGD, aes(x = disability, y = mean_value, fill = HH04)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +  # Grouped bar chart
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3.5) +  # Add values on bars
  scale_fill_manual(values = c(navy_palette[4], red_palette[2])) +  # Apply custom color palette
  facet_wrap(~ HH07_cat) +  # Create facets for each age group
  labs(
    title = "Outcome 4.2 by Gender, Age, and Disability Status",
    x = "Disability Status",
    y = "Mean Value",
    fill = "Gender",
    caption = "Note: Only 18 and above"
  ) +
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +  # Limit the y-axis from 0 to 1
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for readability
    axis.text.y = element_text(size = 10)  # Adjust y-axis label size for readability
  )
```


```{r, echo=FALSE, warning=FALSE}

###Chart

ggplot(vaw01_percentages, aes(x = reorder(Question, Percentage), y = Percentage, fill = Question)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), 
            position = position_stack(vjust = 0.5), size = 3.5) +  # Add percentage labels on bars
  coord_flip() +  # Flip the axes for better readability
  labs(
    title = "Justification for Violence Against Women",
    x = "Justification",
    y = "Percentage",
    caption = "Note: Percentages represent the proportion of respondents who agree with the justification."
  ) +
  scale_fill_unhcr_d() +  # Apply UNHCR color palette
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.y = element_text(size = 9),  # Adjust text size for readability
    legend.position = "none"  # Remove the legend for simplicity
  )

```

## Child Protection

### 5.2 Proportion of children who participate in community-based child protection programmes


```{r, include=FALSE}

outcome5_2 <- RMS_SSD_2023_ind %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "outcome5_2",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(outcome5_2, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


##Table with disability and gender

outcome5_2_AGD <- RMS_SSD_2023_ind %>%
  filter(!is.na(HH04) & !is.na(disability) & !is.na(pop_groups)) %>%  # Missing pipe added here
  group_by(HH04, pop_groups, disability) %>%
  summarise(
    var_name = "outcome5_2",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(outcome5_2), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                  # Weighted total count
    mean_value = survey_mean(outcome5_2, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )

##Chart with pop groups

gender_colors <- c("Male" = "#8395B9", "Female" = "#E0E9FE")



```


```{r, echo=FALSE, warning=FALSE}

ggplot(outcome5_2_AGD, aes(x = HH04, y = mean_value, fill = HH04)) +  # Fill mapped to HH04 for gender
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  facet_wrap(~ pop_groups) +  # Create separate plots for each population group
  labs(
    title = "Outcome 5.2 by Population Groups and Gender",
    x = "Gender",
    y = "Proportion of Children",
    caption = "Note: Only children between 5 to 17"
  ) +
  scale_fill_manual(values = gender_colors) +  # Apply custom colors for male and female
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )

```


## Well-being and Basic Needs

### 8.2 Proportion of people with primary reliance on clean (cooking) fuels and technology

```{r, include=FALSE}

outcome8_2 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "outcome8_2",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(outcome8_2, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )


# Define stove categories based on the provided list
stove_labels <- c(
  "1" = "Solar cooker (thermal energy from the sun)",
  "2" = "Electric stove",
  "3" = "Piped natural gas stove",
  "4" = "Biogas stove",
  "5" = "Liquefied petroleum gas (LPG)/cooking gas stove",
  "6" = "Manufactured solid fuel stove",
  "7" = "Traditional solid fuel stove (non-manufactured)",
  "8" = "Moveable firepan",
  "9" = "Three stone stove/open fire",
  "10" = "Liquid fuel stove",
  "96" = "Other, specify"
)

# Summarize the counts and percentages for each category
cook02_percentages <- main %>%
  filter(!is.na(COOK02)) %>%  # Exclude missing values
  count(COOK02) %>%
  mutate(Percentage = n / sum(n) * 100) %>%
  mutate(COOK02 = factor(COOK02, levels = names(stove_labels), labels = stove_labels))

```


```{r, echo=FALSE, warning=FALSE}

###Chart of outcome 8_2 by pop groups

ggplot(outcome8_2, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 8.2",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )


```

```{r, echo=FALSE, warning=FALSE}

ggplot(cook02_percentages, aes(x = reorder(COOK02, Percentage), y = Percentage, fill = COOK02)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), 
            position = position_stack(vjust = 0.5), size = 3.5) +  # Add percentage labels
  coord_flip() +  # Flip the chart for better readability
  labs(
    title = "Distribution of Stove Types (COOK02)",
    x = "Stove Type",
    y = "Percentage",
    caption = "Source: RMS SSD 2023"
  ) +
  scale_fill_unhcr_d() +  # Apply UNHCR color palette
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.y = element_text(size = 10),  # Adjust text size for readability
    legend.position = "none"  # Remove legend for simplicity
  )

```


## Sustainable housing and Settlements

### 9.1 Proportion of people living in habitable and affordable housing

```{r, include=FALSE}

####Standard tables 


composite_outcome9_1 <- main %>%
  select(pop_groups, dwe05_cat, habitablehousing, dwe09_cat) %>%
  pivot_longer(cols = c(dwe05_cat, habitablehousing, dwe09_cat),  # Pivot the three variables
               names_to = "facility", 
               values_to = "access") %>%
  group_by(pop_groups, facility) %>%
  summarise(percentage = mean(access, na.rm = TRUE) * 100) %>%
  ungroup()


outcome9_1 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "outcome9_1",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(outcome9_1, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )


```


```{r, echo=FALSE, warning=FALSE}
###Chart of impact 9.1 by pop groups

ggplot(outcome9_1, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 9.1",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )

```

```{r, echo=FALSE, warning=FALSE}
###Chart for above with all dimensions 


ggplot(composite_outcome9_1, aes(x = facility, y = percentage, fill = pop_groups)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.1f%%", percentage)), 
            position = position_dodge(0.7), vjust = -0.5, size = 3.5) +  # Add percentage labels on bars
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_x_discrete(labels = c(
    "dwe05_cat" = "Not overcrowded",
    "habitablehousing" = "Habitable Housing",
    "dwe09_cat" = "Affordable"
  )) +  # Add descriptive labels to the x-axis
  labs(
    title = "Access to Housing Facilities by Population Group",
    x = "Facility",
    y = "Percentage Access",
    fill = "Population Groups"
  ) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),  # Rotate x-axis labels for readability
    strip.text = element_text(size = 10)  # Adjust label size
  )

```

### 9.2 Proportion of people that have energy to ensure lighting


```{r, include=FALSE}

outcome9_2 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "outcome9_2",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(outcome9_2, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )



# Define stove categories based on the provided list
lighting_labels <- c(
  "1" =	"Electricity",
  "2" =	"Solar home system",
  "3"	= "Solar-powered lantern or flashlight",
  "4" = "Rechargeable flashlight, mobile, torch or lantern",
  "5" = "Battery powered flashlight, torch or lantern",
  "6" =	"Biogas lamp",
  "7" =	"LPG lamp",
  "8" = "Gasoline lamp",
  "9"	= "Kerosene or paraffin lamp",
  "10" = "Oil lamp",
  "11" = "Candle",
  "12" ="Open fire",
  "96" ="Other, specify"
)

# Summarize the counts and percentages for each category
light02_percentages <- main %>%
  filter(!is.na(LIGHT02)) %>%  # Exclude missing values
  count(LIGHT02) %>%
  mutate(Percentage = n / sum(n) * 100) %>%
  mutate(LIGHT02 = factor(LIGHT02, levels = names(lighting_labels), labels = lighting_labels))


##Add a chart on the availability


# Categorize electricity availability and calculate percentages
main <- main %>%
  mutate(
    electricity_availability = case_when(
      LIGHT05 == 1 ~ "24 hours",
      LIGHT05_11 < 4 ~ "Less than 4 hours",
      LIGHT05_22 < 60 ~ "Less than 1 hour",
      TRUE ~ "No electricity"
    )
  ) 

# Calculate the percentage distribution within each population group
availability_summary <- main %>%
  group_by(pop_groups, electricity_availability) %>%  # Group by population groups and availability categories
  summarise(count = n(), .groups = "drop") %>%        # Count occurrences of each category
  group_by(pop_groups) %>%                            # Group by population group again to calculate percentages within each group
  mutate(percentage = count / sum(count) * 100)       # Calculate percentage within each population group



```


```{r, echo=FALSE, warning=FALSE}

###Chart of outcome 9.2 by pop groups

ggplot(outcome9_2, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 9.2",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )

```


```{r, echo=FALSE, warning=FALSE}

# Create the chart

ggplot(light02_percentages, aes(x = reorder(LIGHT02, Percentage), y = Percentage, fill = LIGHT02)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), 
            position = position_stack(vjust = 0.5), size = 3.5) +  # Add percentage labels
  coord_flip() +  # Flip the chart for better readability
  labs(
    title = "Distribution of Energy of Lighting (LIGHT02)",
    x = "Lighting Type",
    y = "Percentage",
    caption = "Source: RMS SSD 2023"
  ) +
  scale_fill_unhcr_d() +  # Apply UNHCR color palette
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.y = element_text(size = 10),  # Adjust text size for readability
    legend.position = "none"  # Remove legend for simplicity
  )
```


```{r, echo=FALSE, warning=FALSE}
ggplot(availability_summary, aes(x = electricity_availability, y = percentage, fill = electricity_availability)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = paste0(round(percentage, 1), "%")),
            position = position_stack(vjust = 0.5),
            color = ifelse(availability_summary$percentage > 15, "white", "black"), # Change label color based on bar size
            size = 3.5) +  # Slightly larger text size for better readability
  scale_fill_unhcr_d() +
  scale_y_continuous(labels = scales::percent_format(scale = 1), limits = c(0, 100), expand = c(0, 0)) +  # Limit y-axis to 100%
  labs(
    title = "Electricity Availability by Population Group",
    x = "Availability Category",
    y = "Percentage (%)",
    fill = "Availability"
  ) +
  facet_wrap(~ pop_groups) +
  coord_flip() +  # Flip coordinates for horizontal bars
  theme_unhcr()   # Apply UNHCR theme

```


## Healthy Lives

### 10.1  Proportion of children aged 9 months to five years who have received measles vaccination


```{r, include=FALSE}
###Table 

outcome10_1 <- RMS_SSD_2023_ind %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "outcome10_1",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(outcome10_1, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


##Table with disability and gender


outcome10_1_AGD <- RMS_SSD_2023_ind %>%
  filter(!is.na(HH04) & !is.na(disability) & !is.na(pop_groups) & HH07 < 5 ) %>%  # Exclude HH07_cat categories 1, 2, and 5
  group_by(HH07_cat, HH04, pop_groups) %>%
  summarise(
    var_name = "outcome1_2",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(outcome10_1), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(outcome10_1, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )


##Chart with pop groups

gender_colors <- c("Male" = "#8395B9", "Female" = "#E0E9FE")



```


```{r, echo=FALSE, warning=FALSE}
###Chart of outcome 10.1 by pop groups

ggplot(outcome10_1, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 10.1",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )



```


```{r, echo=FALSE, warning=FALSE}

ggplot(outcome10_1_AGD, aes(x = HH04, y = mean_value, fill = HH04)) +  # Fill mapped to HH04 for gender
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3) +  # Add values on bars
  facet_wrap(~ pop_groups) +  # Create separate plots for each population group
  labs(
    title = "Outcome 10.1 by Population Groups and Gender",
    x = "Gender",
    y = "Proportion of Children",
    caption = "Note: Only children under 5"
  ) +
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +  # Limit y-axis to [0, 1] for proportions
  scale_fill_manual(values = gender_colors) +  # Apply custom colors for male and female
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )


```

### 10.2  Proportion of births attended by skilled health personnel


```{r, include=FALSE}
outcome10_2 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "outcome10_2",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(outcome10_2, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


```


```{r, echo=FALSE, warning=FALSE}


###Chart of outcome 10.2 by pop groups

ggplot(outcome10_2, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 10.2",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )


```


## Clean Water,Sanitation and Hygiene

### 12.1 Proportion of people using at least basic drinking water services


```{r, include=FALSE}
####Standard tables 


composite_outcome12_1 <- main %>%
  select(pop_groups, dwa_cond1, dwa_cond2, dwa_cond3) %>%
  pivot_longer(cols = c(dwa_cond1, dwa_cond2, dwa_cond3),  # Pivot the three variables
               names_to = "facility", 
               values_to = "conditions") %>%
  group_by(pop_groups, facility) %>%
  summarise(percentage = mean(conditions, na.rm = TRUE) * 100) %>%
  ungroup()

###Chart for above with all dimensions 

outcome12_1 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "outcome12_1",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(outcome12_1, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )


```


```{r, echo=FALSE, warning=FALSE}

ggplot(composite_outcome12_1, aes(x = facility, y = percentage, fill = pop_groups)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.1f%%", percentage)), 
            position = position_dodge(0.7), vjust = -0.5, size = 3.5) +  # Add percentage labels on bars
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_x_discrete(labels = c(
    "dwa_cond1" = "Reachable under 30 minutes",
    "dwa_cond2" = "From an improved source",
    "dwa_cond3" = "In the dwelling/yard/plot"
  )) +  # Add descriptive labels to the x-axis
  labs(
    title = "Access to Basic Drinking Services",
    x = "At least basic drinking water services",
    y = "Percentage Access",
    fill = "Population Groups"
  ) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),  # Rotate x-axis labels for readability
    strip.text = element_text(size = 10)  # Adjust label size
  )


```


```{r, echo=FALSE, warning=FALSE}

###Chart of outcome 12_1 by pop groups

ggplot(outcome12_1, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 12.1",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )

```

### 12.2 Proportion of people with access to a safe household toilet

```{r, include=FALSE}

####Standard tables 


composite_outcome12_2 <- main %>%
  select(pop_groups, toi_cond1, toi_cond2, toi_cond3) %>%
  pivot_longer(cols = c(toi_cond1, toi_cond2, toi_cond3),  # Pivot the three variables
               names_to = "facility", 
               values_to = "conditions") %>%
  group_by(pop_groups, facility) %>%
  summarise(percentage = mean(conditions, na.rm = TRUE) * 100) %>%
  ungroup()



outcome12_2 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "outcome12_2",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(outcome12_2, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )




```


```{r, echo=FALSE, warning=FALSE}

###Chart of outcome 12_2 by pop groups

ggplot(outcome12_2, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 12.2",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )


```



```{r, echo=FALSE, warning=FALSE}



###Chart for above with all dimensions 


ggplot(composite_outcome12_2, aes(x = facility, y = percentage, fill = pop_groups)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.1f%%", percentage)), 
            position = position_dodge(0.7), vjust = -0.5, size = 3.5) +  # Add percentage labels on bars
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_x_discrete(labels = c(
    "toi_cond1" = "Improved sanitation facility",
    "toi_cond2" = "Safe disposal in situ of excreta",
    "toi_cond3" = "Toilet is not shared with other households"
  )) +  # Add descriptive labels to the x-axis
  labs(
    title = "Access to Basic Drinking Services",
    x = "Improved Toilet",
    y = "Percentage Access",
    fill = "Population Groups"
  ) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),  # Rotate x-axis labels for readability
    strip.text = element_text(size = 10)  # Adjust label size
  ) + 
  scale_y_continuous(limits=c(0,100), expand = c(0,0)) ### limit if needed


```


## Self Reliance, Economic Inclusion and Livelihoods


### 13.1 Proportion of people with an account at a bank or other financial institution or with a mobile-moneyservice provider
```{r, include=FALSE}



composite_outcome13_1 <- main %>%
  select(pop_groups, BANK01, BANK02,  BANK04, BANK05) %>%
  pivot_longer(cols = c(BANK01, BANK02, BANK04, BANK05),  # Pivot the three variables
               names_to = "access", 
               values_to = "conditions") %>%
  group_by(pop_groups, access) %>%
  summarise(percentage = mean(conditions, na.rm = TRUE) * 100) %>%
  ungroup()



outcome13_1 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "outcome13_1",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(outcome13_1, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )



#### Table and chart that shows results by age/sex/diversity

outcome13_1_AGD <- RMS_SSD_2023_main %>%
  filter(!is.na(HH04) & !is.na(disability) & !is.na(HH07_cat) & HH07 > 18) %>%  # Exclude HH07_cat categories 1, 2, and 5
  group_by(HH07_cat, HH04, disability) %>%
  summarise(
    var_name = "outcome13_1",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(outcome13_1), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(outcome13_1, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )



####Chart with the AGD variables 


navy_palette <- c("#E0E9FE", "#B8C9EE", "#8395B9", "#506489", "#18375F")
red_palette <- c(unhcr_pal(12, "pal_red"))



```


```{r, echo=FALSE, warning=FALSE}
###Chart for above with all dimensions 

ggplot(composite_outcome13_1, aes(x = access, y = percentage, fill = pop_groups)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +  # Correct stat to "identity"
  geom_text(aes(label = sprintf("%.1f%%", percentage)), 
            position = position_dodge(0.7), vjust = -0.5, size = 3.5) +  # Add percentage labels on bars
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_x_discrete(labels = c(
    "BANK01" = "Account in financial institution",
    "BANK02" = "Have a ATM/debit card",
    "BANK04" = "Used mobile money in the last 12 months",
    "BANK05" = "Personally used mobile money in the last 12 months"
  )) +  # Add descriptive labels to the x-axis
  labs(
    title = "Percentage of People Financially Included",
    x = "Financial Inclusion",
    y = "Percentage",
    fill = "Population Groups"
  ) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),  # Rotate x-axis labels for readability
    strip.text = element_text(size = 10)  # Adjust label size
  ) +
  scale_y_continuous(limits = c(0, 50), expand = c(0, 0))  # Limit y-axis from 0 to 100%

```


```{r, echo=FALSE, warning=FALSE}

##Chart for the indicator above



ggplot(outcome13_1, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 13.1",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )

```


```{r, echo=FALSE, warning=FALSE}



ggplot(outcome13_1_AGD, aes(x = disability, y = mean_value, fill = HH04)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +  # Grouped bar chart
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3.5) +  # Add values on bars
  scale_fill_manual(values = c(navy_palette[4], red_palette[2])) +  # Apply custom color palette
  facet_wrap(~ HH07_cat) +  # Create facets for each age group
  labs(
    title = "Outcome 13.1 by Gender, Age, and Disability Status",
    x = "Disability Status",
    y = "Mean Value",
    fill = "Gender",
    caption = "Note: Only 18 and above"
  ) +
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +  # Limit the y-axis from 0 to 1
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for readability
    axis.text.y = element_text(size = 10)  # Adjust y-axis label size for readability
  )

```

### 13.2 Proportion of people who self-report positive changes in their income compared to previous year

```{r, include=FALSE}

# Define income categories based on the provided list
inc01_labels <- c(
  "1" = "Increased compared to previous year",
  "2" = "Been the same compared to previous year",
  "3" = "Decreased compared to previous year"  
)

# Summarize the counts and percentages for each category
INC01_percentages <- main %>%
  filter(!is.na(INC01)) %>%  # Exclude missing values
  count(INC01) %>%
  mutate(Percentage = n / sum(n) * 100) %>%
  mutate(INC01 = factor(INC01, levels = names(inc01_labels), labels = inc01_labels))
         

# Define income categories based on the provided list
inc02_labels <- c(
  "1" = "More",
  "2" = "The same",
  "3" = "Fewer"  
)

# Summarize the counts and percentages for each category

INC02_percentages <- main %>%
  filter(!is.na(INC02)) %>%  # Exclude missing values
  count(INC02) %>%
  mutate(Percentage = n / sum(n) * 100) %>%
  mutate(INC02 = factor(INC02, levels = names(inc02_labels), labels = inc02_labels))



outcome13_2 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "outcome13_2",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(outcome13_2, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


#### Table and chart that shows results by age/sex/diversity

outcome13_2_AGD <- RMS_SSD_2023_main %>%
  filter(!is.na(HH04) & !is.na(disability) & !is.na(HH07_cat) & HH07 > 18) %>%  # Exclude HH07_cat categories 1, 2, and 5
  group_by(HH07_cat, HH04, disability) %>%
  summarise(
    var_name = "outcome13_2",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(outcome13_2), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(outcome13_2, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )

navy_palette <- c("#E0E9FE", "#B8C9EE", "#8395B9", "#506489", "#18375F")
red_palette <- c(unhcr_pal(12, "pal_red"))


```


```{r, echo=FALSE, warning=FALSE}
# Create the chart

ggplot(INC01_percentages, aes(x = reorder(INC01, Percentage), y = Percentage, fill = INC01)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), 
            position = position_stack(vjust = 0.5), size = 3.5) +  # Add percentage labels
  coord_flip() +  # Flip the chart for better readability
  labs(
    title = "changes in income in the last 12 months (INC01)",
    x = "Changes",
    y = "Percentage",
    caption = "Source: RMS SSD 2023"
  ) +
  scale_fill_unhcr_d() +  # Apply UNHCR color palette
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.y = element_text(size = 10),  # Adjust text size for readability
    legend.position = "none"  # Remove legend for simplicity
  )


```


```{r, echo=FALSE, warning=FALSE}


ggplot(outcome13_2, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 13.2",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )

```


```{r, echo=FALSE, warning=FALSE}

# Create the chart

ggplot(INC02_percentages, aes(x = reorder(INC02, Percentage), y = Percentage, fill = INC02)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), 
            position = position_stack(vjust = 0.5), size = 3.5) +  # Add percentage labels
  coord_flip() +  # Flip the chart for better readability
  labs(
    title = "Changes in income in the last 12 months (INC01)",
    x = "Affordability",
    y = "Percentage",
    caption = "Source: RMS SSD 2023"
  ) +
  scale_fill_unhcr_d() +  # Apply UNHCR color palette
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.y = element_text(size = 10),  # Adjust text size for readability
    legend.position = "none"  # Remove legend for simplicity
  )


```


```{r, echo=FALSE, warning=FALSE}
ggplot(outcome13_2_AGD, aes(x = disability, y = mean_value, fill = HH04)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +  # Grouped bar chart
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3.5) +  # Add values on bars
  scale_fill_manual(values = c(navy_palette[4], red_palette[2])) +  # Apply custom color palette
  facet_wrap(~ HH07_cat) +  # Create facets for each age group
  labs(
    title = "Outcome 13.2 by Gender, Age, and Disability Status",
    x = "Disability Status",
    y = "Mean Value",
    fill = "Gender",
    caption = "Note: Only 18 and above"
  ) +
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +  # Limit the y-axis from 0 to 1
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for readability
    axis.text.y = element_text(size = 10)  # Adjust y-axis label size for readability
  )


```

### 13.3 Proportion of people (working age) who are unemployed

```{r, include=FALSE}

outcome13_3 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>% 
    mutate(outcome13_3 = as.numeric(outcome13_3)) %>%  # Exclude if pop groups is N     # 
  group_by(pop_groups) %>%                                # Group by pop_groups
  summarise(                                              # Summarise to compute values
    var_name = "outcome13_3",                             # Name of the variable
    num_obs_uw = unweighted(n()),                         # Unweighted total count
    denominator = survey_total(),                         # Weighted total count
    mean_value = survey_mean(outcome13_3, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


#### Table and chart that shows results by age/sex/diversity

outcome13_3_AGD <- RMS_SSD_2023_main %>%
  filter(!is.na(disability) & !is.na(HH07_cat) & HH07 > 18) %>%  # Exclude HH07_cat categories 1, 2, and 5
  group_by(HH07_cat, disability,pop_groups ) %>%
    mutate(outcome13_3 = as.numeric(outcome13_3)) %>%  
  summarise(
    var_name = "outcome13_3",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(outcome13_3), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(outcome13_3, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )

####Chart with the AGD variables 


navy_palette <- c("#E0E9FE", "#B8C9EE", "#8395B9", "#506489", "#18375F")
red_palette <- c(unhcr_pal(12, "pal_red"))

```


```{r, echo=FALSE, warning=FALSE}
ggplot(outcome13_3, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 13.3",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )

```


```{r, echo=FALSE, warning=FALSE}

ggplot(outcome13_3_AGD, aes(x = disability, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +  # Grouped bar chart
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3.5) +  # Add values on bars
  scale_fill_manual(values = c(navy_palette[4], red_palette[2])) +  # Apply custom color palette
  facet_wrap(~ HH07_cat) +  # Create facets for each age group
  labs(
    title = "Outcome 13.3 by Gender, Age, and Disability Status",
    x = "Disability Status",
    y = "Mean Value",
    fill = "Population Groups",
    caption = "Note: Only individuals 18 and above"
  ) +
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +  # Limit the y-axis from 0 to 1
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for readability
    axis.text.y = element_text(size = 10),  # Adjust y-axis label size for readability
    strip.text = element_text(face = "bold")  # Bold facet labels
  
  )
```


## Local Integration and other Local Solutions

### 16.1 Proportion of people with secure tenure rights to housing and/or land


```{r, include=FALSE}

##Table by population groups

outcome16_1 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "outcome16_1",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(outcome16_1, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )




###Check on DWE10


table(main$DWE10)
# Define DWE10 categories based on the provided list
DWE10_labels <- c(
  "1" = "Very unlikely",
  "2" = "Somewhat unlikely",
  "3" = "Somewhat likely",
  "4" = "Very likely",
  "99" = "Don't know"
)

# Convert DWE10 to a factor with correct levels and labels BEFORE summarizing
main <- main %>%
  mutate(DWE10 = factor(DWE10, levels = names(DWE10_labels), labels = DWE10_labels))

# Summarize the counts and percentages for each category
DWE10_percentages <- main %>%
  filter(!is.na(DWE10)) %>%  # Exclude missing values
  count(DWE10) %>%
  mutate(Percentage = n / sum(n) * 100)  # Calculate percentage based on total valid responses




```


```{r, echo=FALSE, warning=FALSE}
###Chart of impact 16_1 by pop groups

ggplot(outcome16_1, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 16.1",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )



```


```{r, echo=FALSE, warning=FALSE}

ggplot(DWE10_percentages, aes(x = reorder(DWE10, Percentage), y = Percentage, fill = DWE10)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), 
            position = position_stack(vjust = 0.5), size = 3.5) +  # Add percentage labels
  coord_flip() +  # Flip the chart for better readability
  labs(
    title = "Likelihood of losing housing/land in the next 12 months",
    x = "Likelihood",
    y = "Percentage",
    caption = "Source: RMS SSD 2023"
  ) +
  scale_fill_unhcr_d() +  # Apply UNHCR color palette
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.y = element_text(size = 10),  # Adjust text size for readability
    legend.position = "none"  # Remove legend for simplicity
  )


```

### 16.2  Proportion of people covered by national social protection systems


```{r, include=FALSE}

##Table by population groups

outcome16_2 <- RMS_SSD_2023_main %>%
  filter(!is.na(pop_groups)) %>%                     # Exclude if pop groups is NA
  group_by(pop_groups) %>%                           # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "outcome16_2",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(outcome16_2, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )


#### social protection services

###Please delete/adjust response options accordingly for the chart

# Define the mapping for SPF01 variables (social protection services)
spf01_mapping <- c(
  "SPF01a" = "Cash / in-kind transfers",
  "SPF01b" = "School feeding",
  "SPF01c" = "Public works",
  "SPF01d" = "Subsidies / fee waivers",
  "SPF01e" = "Unemployment benefits",
  "SPF01f" = "Health insurance",
  "SPF01g" = "Old age pension",
  "SPF01h" = "Crop / livestock insurance",
  "SPF01j" = "Social work (child protection, disability, old persons, GBV)",
  "SPF01k" = "Family support",
  "SPF01l" = "Psychosocial support",
  "SPF01m" = "Vocational training",
  "SPF01n" = "Job search services",
  "SPF01o" = "Wage subsidies",
  "SPF01p" = "Improvements of land tenure security"
)

# Step 2: Calculate the percentage of individuals receiving each service
spf01_percentages <- main %>%
  summarise(across(c(SPF01b, SPF01c, SPF01g), 
                   ~ mean(. == 1, na.rm = TRUE) * 100)) %>%
  pivot_longer(cols = everything(), 
               names_to = "Service", 
               values_to = "Percentage") %>%
  mutate(Service = spf01_mapping[Service])  # Map column names to descriptive labels



```


```{r, echo=FALSE, warning=FALSE}

###Chart of impact 16_1 by pop groups

ggplot(outcome16_2, aes(x = pop_groups, y = mean_value, fill = pop_groups)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of RBM Core Outcome 16.2",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )


```

```{r, echo=FALSE, warning=FALSE}

ggplot(spf01_percentages, aes(x = reorder(Service, Percentage), y = Percentage, fill = Service)) +
  geom_bar(stat = "identity", width = 0.7, color = "white") +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), 
            position = position_stack(vjust = 0.5), size = 3.5) +  # Add percentage labels on bars
  coord_flip() +  # Flip the axes for better readability
  labs(
    title = "Proportion of Individuals Covered by National Social Protection Systems",
    x = "Social Protection Service",
    y = "Percentage",
    caption = "Note: Each service is calculated independently."
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.y = element_text(size = 9),  # Adjust text size for readability
    legend.position = "none"  # Remove the legend for simplicity
  )



```


## RBM Core Indicators Summary Table 

```{r, include=FALSE}


# Combine all indicators into one data frame
combined_RBM_indicators <- bind_rows(
  impact2_2,
  impact2_3,
  impact3_2a,
  impact3_2b,
  impact3_3,
  outcome1_2,
  outcome1_3,
  outcome4_1,
  outcome4_2,
  outcome5_2,
  outcome8_2,
  outcome9_1,
  outcome9_2,
  outcome10_1,
  outcome10_2,
  outcome12_1,
  outcome12_2,
  outcome13_1,
  outcome13_2,
  outcome13_3,
  outcome14_1,
  outcome16_1,
  outcome16_2
)


# Keep only the specified columns
combined_RBM_indicators_table <- combined_RBM_indicators %>%
  select(pop_groups, var_name, num_obs_uw,denominator, mean_value)

# Split the combined table by population group
tables_by_group <- combined_RBM_indicators_table %>%
  group_by(pop_groups) %>%
  group_split()


```


```{r, echo=FALSE}



# Function to create a formatted gt table for a specific population group
create_gt_table <- function(data) {
  pop_group_name <- unique(data$pop_groups)
  
  data %>%
    select(-pop_groups) %>%  # Remove the pop_groups column, as it's redundant for each separate table
    gt() %>%
    tab_header(
      title = paste("Summary of RBM Indicators for", pop_group_name),
      subtitle = "Table displays unweighted counts, weighted totals, and indicator values"
    ) %>%
    fmt_number(
      columns = c(num_obs_uw, denominator),  # Use c(...) instead of vars(...)
      decimals = 0  # No decimals for unweighted and weighted totals
    ) %>%
    fmt_number(
      columns = c(mean_value),  # Use c(...) instead of vars(...)
      decimals = 2  # Round indicator value to 2 decimal places
    ) %>%
    cols_label(
      var_name = "Core Indicator",
      num_obs_uw = "Unweighted Count",
      denominator = "Weighted Total",
      mean_value = "Indicator Value"
    ) %>%
    tab_options(
      table.font.size = px(10),    # Adjust font size for better fit
      table.width = pct(100)       # Set table width to 100% of the page width
    ) %>%
    tab_style(
      style = list(
        cell_text(weight = "bold")
      ),
      locations = cells_column_labels(everything())
    )
}

# Render each table for different population groups
for (table_data in tables_by_group) {
  create_gt_table(table_data) %>%
    print()  # Ensure each table gets rendered in the report
}


```

## Acknowledgements

*Acknowledgement of all organizations participating in the needs assessment, including agencies, NGOs, government entities, and academic institutions*

**Firstname Lastname**, Title of person and country,

[name\@email.org](mailto:name@email.org){.email}

**Firstname Lastname**, Title of person and country,

[name\@email.org](mailto:name@email.org){.email}
